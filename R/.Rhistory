##########
### Simulation figures
##########
rm(list=ls())
library(ggplot2)
library(gridExtra)
library(ImpulseDE2)
library(cowplot) # this overrides ggplot from gpglots2 to be more paper like and gives plot_grid!
source("/home/david/gdrive/phd/code/functions/plotROC_PR.R")
source("/home/david/gdrive/phd/code/functions/plotDifferentialDECalls.R")
scaRefTextSize <- 14
scaResScale <- 2
scaLabelsScale <- 2
# Load local output new ImpulseDE2
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runImpulseDE2Locally/objectImpulseDE2JovCase.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runImpulseDE2Locally/scaRunTime_ImpulseDE2JovCase.RData")
# Load local output new DESeq2
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runDESeq2Locally/vecPval_DESeq2_JovCase.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runDESeq2Locally/scaRunTime_DESeq2_JovCase.RData")
# Load local output file (edge)
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runEdgeLocally/vecPval_edgeJovCase.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runEdgeLocally/vecQval_edgeJovCase.RData")
# Cluster output ImpulseDE
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runImpulseDEcluster/scaRunTime_ImpulseDE_JovCase.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runImpulseDEcluster/vecQval_ImpulseDE_JovCase.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/procData/matDataJovCase.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/procData/dfAnnotationJovCase.RData")
# Add edge results into p-value table
vecPvalJovCase_ImpulseDE2 <- array(NA, dim(matDataJovCase)[1])
names(vecPvalJovCase_ImpulseDE2) <- rownames(matDataJovCase)
vecPvalJovCase_ImpulseDE2[rownames(objectImpulseDE2JovCase$dfImpulseDE2Results)] <- objectImpulseDE2JovCase$dfImpulseDE2Results$p
matPval_JovCase <- data.frame(
ImpulseDE2=vecPvalJovCase_ImpulseDE2,
#ImpulseDE=
DESeq2=vecPval_DESeq2_JovCase[names(vecPvalJovCase_ImpulseDE2)],
Edge=vecPval_edge_Case[names(vecPvalJovCase_ImpulseDE2)]
)
rownames(matPval_JovCase) <- names(vecPvalJovCase_ImpulseDE2)
# Create BH corrected Q-value matrix
# Check that all have the same number of NAs so that BH correction is fair
apply(matPval_JovCase,2,function(method) sum(is.na(method))) # almost
matQval_JovCase <- as.data.frame(do.call(cbind, lapply(seq(1,dim(matPval_JovCase)[2]), function(m){
p.adjust(matPval_JovCase[,m], method = "BH")
})))
colnames(matQval_JovCase) <- colnames(matPval_JovCase)
rownames(matQval_JovCase) <- rownames(matPval_JovCase)
matQval_JovCase[names(vecQval_ImpulseDE_JovCase),"ImpulseDE"] <- vecQval_ImpulseDE_JovCase
apply(matQval_JovCase,2,function(method) sum(is.na(method))) # inbalanve of NAs - correct
matDataJovCaseProc <- matDataJovCase[as.vector(rownames(matPval_JovCase)),]
vecMuJovCase <- apply(matDataJovCase, 1, function(g) mean(g, na.rm=TRUE))
# Load local output new ImpulseDE2
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runImpulseDE2Locally/objectImpulseDE2JovCaseCtrl.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runImpulseDE2Locally/scaRunTime_ImpulseDE2JovCaseCtrl.RData")
# Load local output new DESeq2
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runDESeq2Locally/vecPval_DESeq2_JovCaseCtrl.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runDESeq2Locally/scaRunTime_DESeq2_JovCaseCtrl.RData")
# Load local output new DESeq2 with ImpulseDE2 like batch structure
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runDESeq2Locally/vecPval_DESeq2wImpulseDE2likeBatch_JovCaseCtrl.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runDESeq2Locally/scaRunTime_DESeq2wImpulseDE2likeBatch_JovCaseCtrl.RData")
# Load local output file Edge
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runEdgeLocally/vecPval_edgeJovCaseCtrl.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/runEdgeLocally/vecQval_edgeJovCaseCtrl.RData")
# ImpulseDE failed
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/procData/matDataJovCaseCtrl.RData")
load("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/procData/dfAnnotationJovCaseCtrl.RData")
# Add edge results into p-value table
vecPvalJovCaseCtrl_ImpulseDE2 <- array(NA, dim(matDataJovCaseCtrl)[1])
names(vecPvalJovCaseCtrl_ImpulseDE2) <- rownames(matDataJovCaseCtrl)
vecPvalJovCaseCtrl_ImpulseDE2[rownames(objectImpulseDE2JovCaseCtrl$dfImpulseDE2Results)] <- objectImpulseDE2JovCaseCtrl$dfImpulseDE2Results$p
matPval_JovCaseCtrl <- data.frame(
ImpulseDE2=vecPvalJovCaseCtrl_ImpulseDE2,
#ImpulseDE=
DESeq2=vecPval_DESeq2_JovCaseCtrl[names(vecPvalJovCaseCtrl_ImpulseDE2)],
DESeq2ExtraBatch=vecPval_DESeq2wImpulseDE2likeBatch_JovCaseCtrl[names(vecPvalJovCaseCtrl_ImpulseDE2)],
Edge=vecPval_edge_CaseCtrl[names(vecPvalJovCaseCtrl_ImpulseDE2)]
)
rownames(matPval_JovCaseCtrl) <- names(vecPvalJovCaseCtrl_ImpulseDE2)
# Create BH corrected Q-value matrix
# Check that all have the same number of NAs so that BH correction is fair
apply(matPval_JovCaseCtrl,2,function(method) sum(is.na(method))) # ok
matQval_JovCaseCtrl <- as.data.frame(do.call(cbind, lapply(seq(1,dim(matPval_JovCaseCtrl)[2]), function(m){
p.adjust(matPval_JovCaseCtrl[,m], method = "BH")
})))
colnames(matQval_JovCaseCtrl) <- colnames(matPval_JovCaseCtrl)
rownames(matQval_JovCaseCtrl) <- rownames(matPval_JovCaseCtrl)
apply(matQval_JovCaseCtrl,2,function(method) sum(is.na(method)))
matDataJovCaseCtrlProc <- matDataJovCaseCtrl[as.vector(rownames(matPval_JovCaseCtrl)),]
vecMuJovCaseCtrl <- apply(matDataJovCaseCtrlProc, 1, function(g) mean(g, na.rm=TRUE))
# (I) Main text figure
# case ECF of data set with different methods
dfECDFImpulseDE2 <- calcPvalECF( vecPval=matQval_JovCase$ImpulseDE2)
#dfECDFImpulseDE <- calcPvalECF( vecPval=matQval_JovCase$ImpulseDE)
dfECDFDESeq2 <- calcPvalECF( vecPval=matQval_JovCase$DESeq2)
dfECDFEdge <- calcPvalECF( vecPval=matQval_JovCase$Edge)
dfECF_JovCase <- data.frame(
ecf=c(dfECDFImpulseDE2$ecf,
#dfECDFImpulseDE$ecf,
dfECDFDESeq2$ecf,
dfECDFEdge$ecf),
pval=log(c(dfECDFImpulseDE2$p,
#dfECDFImpulseDE$p,
dfECDFDESeq2$p,
dfECDFEdge$p))/log(10),
Method=c(rep("ImpulseDE2", dim(dfECDFImpulseDE2)[1]),
#rep("ImpulseDE", dim(dfECDFImpulseDE)[1]),
rep("DESeq2", dim(dfECDFDESeq2)[1]),
rep("Edge", dim(dfECDFEdge)[1]))
)
# Colour-blind palette
cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
gplotECF_JovCase <- ggplot(dfECF_JovCase) +
geom_line(aes(x=pval, y=ecf, colour=Method), size=1) + scale_colour_manual(values=cbPalette) +
xlim(-25,0) +
ylim(0, sum(matQval_JovCase$ImpulseDE2<0.1, na.rm=TRUE)) +
labs(title="LPS (Jovanovic) case-only") +
xlab("log10 q-value threshold") +
ylab("Significant genes")
print(gplotECF_JovCase)
# case-ctrl ECF of data set with different methods
dfECDFImpulseDE2 <- calcPvalECF( vecPval=matQval_JovCaseCtrl$ImpulseDE2)
#dfECDFImpulseDE <- calcPvalECF( vecPval=matQval_JovCaseCtrl$ImpulseDE)
dfECDFDESeq2 <- calcPvalECF( vecPval=matQval_JovCaseCtrl$DESeq2)
dfECDFDESeq2ExtraBatch <- calcPvalECF( vecPval=matQval_JovCaseCtrl$DESeq2ExtraBatch)
dfECDFEdge <- calcPvalECF( vecPval=matQval_JovCaseCtrl$Edge)
dfECF_JovCaseCtrl <- data.frame(
ecf=c(dfECDFImpulseDE2$ecf,
#dfECDFImpulseDE$ecf,
dfECDFDESeq2$ecf,
dfECDFDESeq2ExtraBatch$ecf,
dfECDFEdge$ecf),
pval=log(c(dfECDFImpulseDE2$p,
#dfECDFImpulseDE$p,
dfECDFDESeq2$p,
dfECDFDESeq2ExtraBatch$p,
dfECDFEdge$p))/log(10),
Method=c(rep("ImpulseDE2", dim(dfECDFImpulseDE2)[1]),
#rep("ImpulseDE", dim(dfECDFImpulseDE)[1]),
rep("DESeq2", dim(dfECDFDESeq2)[1]),
rep("Edge", dim(dfECDFEdge)[1]),
rep("DESeq2\nExtraBatch", dim(dfECDFDESeq2ExtraBatch)[1]))
)
# Colour-blind palette
cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
gplotECF_JovCaseCtrl <- ggplot(dfECF_JovCaseCtrl) +
geom_line(aes(x=pval, y=ecf, colour=Method), size=1) + scale_colour_manual(values=cbPalette) +
xlim(-25,0) +
ylim(0, sum(matQval_JovCase$ImpulseDE2<0.1, na.rm=TRUE)) +
labs(title="LPS (Jovanovic) case-control") +
xlab("log10 q-value threshold") +
ylab("Significant genes")
print(gplotECF_JovCaseCtrl)
# case Correlation plot ImpulseDE2 to DESeq2
dfQvalCorrImpulseDE2DESeq2_JovCase <- data.frame(
ImpulseDE2=log(matQval_JovCase$ImpulseDE2)/log(10),
DESeq2=log(matQval_JovCase$DESeq2)/log(10),
mean=log(vecMuJovCase+1)/log(10)
)
dfQvalCorrImpulseDE2DESeq2_JovCase[is.na(dfQvalCorrImpulseDE2DESeq2_JovCase)] <- 0 # Set NAs (ie failed or non-performed DE analysis) to non-discovery (=1)
scaThres <- -25
dfQvalCorrImpulseDE2DESeq2_JovCase[dfQvalCorrImpulseDE2DESeq2_JovCase < scaThres] <- scaThres
gplotQvalCorrImpulseDE2DESeq2_JovCase <- ggplot(dfQvalCorrImpulseDE2DESeq2_JovCase) +
geom_point(aes(x=ImpulseDE2, y=DESeq2, colour=mean), alpha=0.5) +
geom_abline(slope=1, intercept=0, colour="red", size=1) +
annotate("text", x=-20, y=0, parse = TRUE, size=12,
label=paste0("italic(R) ^ 2 == ",round(cor(dfQvalCorrImpulseDE2DESeq2_JovCase[,1],dfQvalCorrImpulseDE2DESeq2_JovCase[,2]),3)) ) +
labs(title="LPS (Jovanovic) case-only:\n ImpulseDE2 vs DESeq2", colour="log10\nmean\n") +
xlab("log10 q-value ImpulseDE2") +
ylab("log10 q-value DESeq2") +
theme(legend.position="right", legend.direction="vertical",
legend.key.width=unit(10, units="mm"),
legend.key.height=unit(10, units="mm"))
print(gplotQvalCorrImpulseDE2DESeq2_JovCase)
# case Correlation plot ImpulseDE2 to edge
dfQvalCorrImpulseDE2Edge_JovCase <- data.frame(
ImpulseDE2=log(matQval_JovCase$ImpulseDE2)/log(10),
Edge=log(matQval_JovCase$Edge)/log(10),
mean=log(vecMuJovCase+1)/log(10)
)
dfQvalCorrImpulseDE2Edge_JovCase[is.na(dfQvalCorrImpulseDE2Edge_JovCase)] <- 0 # Set NAs (ie failed or non-performed DE analysis) to non-discovery (=1)
scaThres <- -25
dfQvalCorrImpulseDE2Edge_JovCase[dfQvalCorrImpulseDE2Edge_JovCase < scaThres] <- scaThres
gplotQvalCorrImpulseDE2Edge_JovCase <- ggplot(dfQvalCorrImpulseDE2Edge_JovCase) +
geom_point(aes(x=ImpulseDE2, y=Edge, colour=mean), alpha=0.5) +
geom_abline(slope=1, intercept=0, colour="red", size=1) +
annotate("text", x=-20, y=0, parse = TRUE, size=12,
label=paste0("italic(R) ^ 2 == ",round(cor(dfQvalCorrImpulseDE2Edge_JovCase[,1],dfQvalCorrImpulseDE2Edge_JovCase[,2]),3)) ) +
labs(title="LPS (Jovanovic) case-only:\n ImpulseDE2 vs edge", colour="log10\nmean\n") +
xlab("log10 q-value ImpulseDE2") +
ylab("log10 q-value edge") +
theme(legend.position="right", legend.direction="vertical",
legend.key.width=unit(10, units="mm"),
legend.key.height=unit(10, units="mm"))
print(gplotQvalCorrImpulseDE2Edge_JovCase)
# case Correlation plot ImpulseDE2 to ImpulseDE for SI
dfQvalCorrImpulseDE2ImpulseDE_JovCase <- data.frame(
ImpulseDE2=log(matQval_JovCase$ImpulseDE2)/log(10),
ImpulseDE=log(matQval_JovCase$ImpulseDE)/log(10),
mean=log(vecMuJovCase+1)/log(10)
)
dfQvalCorrImpulseDE2ImpulseDE_JovCase[is.na(dfQvalCorrImpulseDE2ImpulseDE_JovCase)] <- 0 # Set NAs (ie failed or non-performed DE analysis) to non-discovery (=1)
scaThres <- -25
dfQvalCorrImpulseDE2ImpulseDE_JovCase[dfQvalCorrImpulseDE2ImpulseDE_JovCase < scaThres] <- scaThres
gplotQvalCorrImpulseDE2ImpulseDE_JovCase <- ggplot(dfQvalCorrImpulseDE2ImpulseDE_JovCase) +
geom_point(aes(x=ImpulseDE2, y=ImpulseDE, colour=mean), alpha=0.5) +
geom_abline(slope=1, intercept=0, colour="red", size=1) +
annotate("text", x=-20, y=0, parse = TRUE, size=12,
label=paste0("italic(R) ^ 2 == ",round(cor(dfQvalCorrImpulseDE2ImpulseDE_JovCase[,1],dfQvalCorrImpulseDE2ImpulseDE_JovCase[,2]),3)) ) +
labs(title="LPS (Jovanovic) case-only:\n ImpulseDE2 vs ImpulseDE", colour="log10\nmean\n") +
xlab("log10 q-value ImpulseDE2") +
ylab("log10 q-value ImpulseDE") +
theme(legend.position="right", legend.direction="vertical",
legend.key.width=unit(10, units="mm"),
legend.key.height=unit(10, units="mm"))
print(gplotQvalCorrImpulseDE2ImpulseDE_JovCase)
save(gplotQvalCorrImpulseDE2ImpulseDE_JovCase, file="/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/figures/RData/gplotQvalCorrImpulseDE2ImpulseDE_JovCase.RData")
# case-ctrl Correlation plot ImpulseDE2 to DESeq2
dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl <- data.frame(
ImpulseDE2=log(matQval_JovCaseCtrl$ImpulseDE2)/log(10),
DESeq2ExtraBatch=log(matQval_JovCaseCtrl$DESeq2ExtraBatch)/log(10),
mean=log(vecMuJovCaseCtrl+1)/log(10)
)
dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl[is.na(dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl)] <- 0 # Set NAs (ie failed or non-performed DE analysis) to non-discovery (=1)
scaThres <- -25
dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl[dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl < scaThres] <- scaThres
gplotQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl <- ggplot(dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl) +
geom_point(aes(x=ImpulseDE2, y=DESeq2ExtraBatch, colour=mean), alpha=0.5) +
geom_abline(slope=1, intercept=0, colour="red", size=1) +
annotate("text", x=-20, y=0, parse = TRUE, size=12,
label=paste0("italic(R) ^ 2 == ",round(cor(dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl[,1],dfQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl[,2]),3)) ) +
labs(title="LPS (Jovanovic) case-control:\n ImpulseDE2 vs DESeq2_ExtraBatch", colour="log10\nmean\n") +
xlab("log10 q-value ImpulseDE2") +
ylab("log10 q-value DESeq2_ExtraBatch") +
theme(legend.position="right", legend.direction="vertical",
legend.key.width=unit(10, units="mm"),
legend.key.height=unit(10, units="mm"))
print(gplotQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl)
# case-ctrl Correlation plot ImpulseDE2 to DESeq2 traditional
dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl <- data.frame(
ImpulseDE2=log(matQval_JovCaseCtrl$ImpulseDE2)/log(10),
DESeq2=log(matQval_JovCaseCtrl$DESeq2)/log(10),
mean=log(vecMuJovCaseCtrl+1)/log(10)
)
dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl[is.na(dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl)] <- 0 # Set NAs (ie failed or non-performed DE analysis) to non-discovery (=1)
scaThres <- -25
dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl[dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl < scaThres] <- scaThres
gplotQvalCorrImpulseDE2DESeq2_JovCaseCtrl <- ggplot(dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl) +
geom_point(aes(x=ImpulseDE2, y=DESeq2, colour=mean), alpha=0.5) +
geom_abline(slope=1, intercept=0, colour="red", size=1) +
annotate("text", x=-20, y=0, parse = TRUE, size=12,
label=paste0("italic(R) ^ 2 == ",round(cor(dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl[,1],dfQvalCorrImpulseDE2DESeq2_JovCaseCtrl[,2]),3)) ) +
labs(title="LPS (Jovanovic) case-control:\n ImpulseDE2 vs DESeq2", colour="log10\nmean\n") +
xlab("log10 q-value ImpulseDE2") +
ylab("log10 q-value DESeq2") +
theme(legend.position="right", legend.direction="vertical",
legend.key.width=unit(10, units="mm"),
legend.key.height=unit(10, units="mm"))
print(gplotQvalCorrImpulseDE2DESeq2_JovCaseCtrl)
# case-ctrl Correlation plot ImpulseDE2 to edge
dfQvalCorrImpulseDE2Edge_JovCaseCtrl <- data.frame(
ImpulseDE2=log(matQval_JovCaseCtrl$ImpulseDE2)/log(10),
Edge=log(matQval_JovCaseCtrl$Edge)/log(10),
mean=log(vecMuJovCaseCtrl+1)/log(10)
)
dfQvalCorrImpulseDE2Edge_JovCaseCtrl[is.na(dfQvalCorrImpulseDE2Edge_JovCaseCtrl)] <- 0 # Set NAs (ie failed or non-performed DE analysis) to non-discovery (=1)
scaThres <- -25
dfQvalCorrImpulseDE2Edge_JovCaseCtrl[dfQvalCorrImpulseDE2Edge_JovCaseCtrl < scaThres] <- scaThres
gplotQvalCorrImpulseDE2Edge_JovCaseCtrl <- ggplot(dfQvalCorrImpulseDE2Edge_JovCaseCtrl) +
geom_point(aes(x=ImpulseDE2, y=Edge, colour=mean), alpha=0.5) +
geom_abline(slope=1, intercept=0, colour="red", size=1) +
annotate("text", x=-20, y=0, parse = TRUE, size=12,
label=paste0("italic(R) ^ 2 == ",round(cor(dfQvalCorrImpulseDE2Edge_JovCaseCtrl[,1],dfQvalCorrImpulseDE2Edge_JovCaseCtrl[,2]),3)) ) +
labs(title="LPS (Jovanovic) case-control:\n ImpulseDE2 vs edge", colour="log10\nmean\n") +
xlab("log10 q-value ImpulseDE2") +
ylab("log10 q-value edge") +
theme(legend.position="right", legend.direction="vertical",
legend.key.width=unit(10, units="mm"),
legend.key.height=unit(10, units="mm"))
print(gplotQvalCorrImpulseDE2Edge_JovCaseCtrl)
# case-ctrl Correlation plot ImpulseDE2 to ImpulseDE
#dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl <- data.frame(
#  ImpulseDE2=log(matQval_JovCaseCtrl$ImpulseDE2)/log(10),
#  ImpulseDE=log(matQval_JovCaseCtrl$ImpulseDE)/log(10),
#  mean=log(vecMuJovCaseCtrl+1)/log(10)
#)
#dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl[is.na(dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl)] <- 0 # Set NAs (ie failed or non-performed DE analysis) to non-discovery (=1)
#scaThres <- -25
#dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl[dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl < scaThres] <- scaThres
#gplotQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl <- ggplot(dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl) +
#  geom_point(aes(x=ImpulseDE2, y=ImpulseDE, colour=mean), alpha=0.5) +
#  geom_abline(slope=1, intercept=0, colour="red", size=1) +
#  annotate("text", x=-20, y=0, parse = TRUE, size=12,
#           label=paste0("italic(R) ^ 2 == ",round(cor(dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl[,1],dfQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl[,2]),3)) ) +
#  labs(title="LPS (Jovanovic) case-control:\n ImpulseDE2 vs ImpulseDE", colour="log10\nmean\n") +
#  xlab("log10 q-value ImpulseDE2") +
#  ylab("log10 q-value ImpulseDE") +
#  theme(legend.position="right", legend.direction="vertical",
#        legend.key.width=unit(10, units="mm"),
#        legend.key.height=unit(10, units="mm"))
#print(gplotQvalCorrImpulseDE2ImpulseDE_JovCaseCtrl)
### Put figure together
lsgplotsFigJankovicMain <- list(
NULL,
#gplotECF_JovCase,
#gplotECF_JovCaseCtrl,
#gplotQvalCorrImpulseDE2DESeq2_JovCase,
#gplotQvalCorrImpulseDE2Edge_JovCase,
gplotQvalCorrImpulseDE2DESeq2_JovCaseCtrl,
gplotQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl,
gplotQvalCorrImpulseDE2Edge_JovCaseCtrl
)
lsgplotsFigJankovicSICase <- list(
gplotECF_JovCaseCtrl,
gplotECF_JovCase,
gplotQvalCorrImpulseDE2DESeq2_JovCase,
gplotQvalCorrImpulseDE2Edge_JovCase
)
# Add margins
marginObject <- theme(plot.margin = unit(c(1,1,1,2), "cm")) #t,r,b,l
lsgplotsFigJankovicMain <- lapply(lsgplotsFigJankovicMain, "+", marginObject)
lsgplotsFigJankovicSICase <- lapply(lsgplotsFigJankovicSICase, "+", marginObject)
# Add text and legend formats
scaRefTextSize <- 14
scaResScale <- 2
scaLabelsScale <- 2
themeObjectStandard <- theme(axis.text=element_text(size=scaRefTextSize*scaResScale),
axis.title=element_text(size=scaRefTextSize*scaResScale,face="bold"),
plot.title=element_text(size=rel(scaResScale),face="bold"),
legend.text=element_text(size=scaRefTextSize*scaResScale),
legend.title=element_text(size=scaRefTextSize*scaResScale),
legend.key.size = unit(scaResScale*2, 'lines'))
themeObjectNoLegend <- theme(axis.text=element_text(size=scaRefTextSize*scaResScale),
axis.title=element_text(size=scaRefTextSize*scaResScale,face="bold"),
plot.title=element_text(size=rel(scaResScale),face="bold"),
legend.position="none")
lsthemeObjects <- list(themeObjectStandard,themeObjectNoLegend,themeObjectNoLegend,themeObjectStandard)
lsthemeObjectsSICase <- list(themeObjectStandard,themeObjectStandard,themeObjectNoLegend,themeObjectStandard)
lsgplotsFigJankovicMain <- lapply(seq(1, length(lsgplotsFigJankovicMain)), function(g){
lsgplotsFigJankovicMain[[g]] + lsthemeObjects[[g]]
})
lsgplotsFigJankovicSICase <- lapply(seq(1, length(lsgplotsFigJankovicSICase)), function(g){
lsgplotsFigJankovicSICase[[g]] + lsthemeObjectsSICase[[g]]
})
graphics.off()
tiff("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/figures/figJovanovicMain.tiff",
width=480*2*4, height=480*2*1)
plot_grid(plotlist=lsgplotsFigJankovicMain,
align="h",
nrow=1, ncol=4,
rel_widths=c(1,1,1,1),
rel_heights=c(1),
labels="AUTO",
label_size=scaRefTextSize*scaResScale*scaLabelsScale)
dev.off()
graphics.off()
graphics.off()
tiff("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/figures/figJovanovicSICase.tiff",
width=480*2*4, height=480*2)
plot_grid(plotlist=lsgplotsFigJankovicSICase,
align="h",
nrow=1, ncol=4,
rel_widths=c(1,1,1,1),
rel_heights=c(1),
labels="AUTO",
label_size=scaRefTextSize*scaResScale*scaLabelsScale)
dev.off()
graphics.off()
lsgplotsFigJankovicSICase <- list(
gplotECF_JovCaseCtrl,
gplotECF_JovCase,
gplotQvalCorrImpulseDE2DESeq2_JovCase,
gplotQvalCorrImpulseDE2Edge_JovCase
)
gplotECF_JovCaseCtrl
dfECF_JovCaseCtrl <- data.frame(
ecf=c(dfECDFImpulseDE2$ecf,
#dfECDFImpulseDE$ecf,
dfECDFDESeq2$ecf,
dfECDFEdge$ecf,
dfECDFDESeq2ExtraBatch$ecf),
pval=log(c(dfECDFImpulseDE2$p,
#dfECDFImpulseDE$p,
dfECDFDESeq2$p,
dfECDFEdge$p,
dfECDFDESeq2ExtraBatch$p))/log(10),
Method=c(rep("ImpulseDE2", dim(dfECDFImpulseDE2)[1]),
#rep("ImpulseDE", dim(dfECDFImpulseDE)[1]),
rep("DESeq2", dim(dfECDFDESeq2)[1]),
rep("Edge", dim(dfECDFEdge)[1]),
rep("DESeq2\nExtraBatch", dim(dfECDFDESeq2ExtraBatch)[1]))
)
cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
gplotECF_JovCaseCtrl <- ggplot(dfECF_JovCaseCtrl) +
geom_line(aes(x=pval, y=ecf, colour=Method), size=1) + scale_colour_manual(values=cbPalette) +
xlim(-25,0) +
ylim(0, sum(matQval_JovCase$ImpulseDE2<0.1, na.rm=TRUE)) +
labs(title="LPS (Jovanovic) case-control") +
xlab("log10 q-value threshold") +
ylab("Significant genes")
print(gplotECF_JovCaseCtrl)
lsgplotsFigJankovicMain <- list(
NULL,
#gplotECF_JovCase,
#gplotECF_JovCaseCtrl,
#gplotQvalCorrImpulseDE2DESeq2_JovCase,
#gplotQvalCorrImpulseDE2Edge_JovCase,
gplotQvalCorrImpulseDE2DESeq2_JovCaseCtrl,
gplotQvalCorrImpulseDE2DESeq2ExtraBatch_JovCaseCtrl,
gplotQvalCorrImpulseDE2Edge_JovCaseCtrl
)
lsgplotsFigJankovicSICase <- list(
gplotECF_JovCaseCtrl,
gplotECF_JovCase,
gplotQvalCorrImpulseDE2DESeq2_JovCase,
gplotQvalCorrImpulseDE2Edge_JovCase
)
marginObject <- theme(plot.margin = unit(c(1,1,1,2), "cm")) #t,r,b,l
lsgplotsFigJankovicMain <- lapply(lsgplotsFigJankovicMain, "+", marginObject)
lsgplotsFigJankovicSICase <- lapply(lsgplotsFigJankovicSICase, "+", marginObject)
scaRefTextSize <- 14
scaResScale <- 2
scaLabelsScale <- 2
themeObjectStandard <- theme(axis.text=element_text(size=scaRefTextSize*scaResScale),
axis.title=element_text(size=scaRefTextSize*scaResScale,face="bold"),
plot.title=element_text(size=rel(scaResScale),face="bold"),
legend.text=element_text(size=scaRefTextSize*scaResScale),
legend.title=element_text(size=scaRefTextSize*scaResScale),
legend.key.size = unit(scaResScale*2, 'lines'))
themeObjectNoLegend <- theme(axis.text=element_text(size=scaRefTextSize*scaResScale),
axis.title=element_text(size=scaRefTextSize*scaResScale,face="bold"),
plot.title=element_text(size=rel(scaResScale),face="bold"),
legend.position="none")
lsthemeObjects <- list(themeObjectStandard,themeObjectNoLegend,themeObjectNoLegend,themeObjectStandard)
lsthemeObjectsSICase <- list(themeObjectStandard,themeObjectStandard,themeObjectNoLegend,themeObjectStandard)
lsgplotsFigJankovicMain <- lapply(seq(1, length(lsgplotsFigJankovicMain)), function(g){
lsgplotsFigJankovicMain[[g]] + lsthemeObjects[[g]]
})
lsgplotsFigJankovicSICase <- lapply(seq(1, length(lsgplotsFigJankovicSICase)), function(g){
lsgplotsFigJankovicSICase[[g]] + lsthemeObjectsSICase[[g]]
})
graphics.off()
tiff("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/figures/figJovanovicMain.tiff",
width=480*2*4, height=480*2*1)
plot_grid(plotlist=lsgplotsFigJankovicMain,
align="h",
nrow=1, ncol=4,
rel_widths=c(1,1,1,1),
rel_heights=c(1),
labels="AUTO",
label_size=scaRefTextSize*scaResScale*scaLabelsScale)
dev.off()
graphics.off()
graphics.off()
tiff("/home/david/gdrive/phd/data/ImpulsDE2/Manuscript_DataSets/figures/figJovanovicSICase.tiff",
width=480*2*4, height=480*2)
plot_grid(plotlist=lsgplotsFigJankovicSICase,
align="h",
nrow=1, ncol=4,
rel_widths=c(1,1,1,1),
rel_heights=c(1),
labels="AUTO",
label_size=scaRefTextSize*scaResScale*scaLabelsScale)
dev.off()
graphics.off()
rm(list=ls())
load("~/gdrive/phd/datasets/2016_Buettner_Astrocytes/Astrocytes.RDATA")
matCountsAstro <- counts.rep.all
dfAnnotationAstro <- data.frame(
cell=colnames(matCountsAstro),
condition=x,
batch=x.b,
stringsAsFactors=FALSE
)
dfAnnotationAstro$populations <- NA
dfAnnotationAstro[dfAnnotationAstro$condition=="FGF",]$populations <- 1
rownames(dfAnnotationAstro) <- dfAnnotationAstro$cell
dfAnnotationAstro$pseudotime <- seq(1,dim(dfAnnotationAstro)[1])
source("~/gitDevelopment/LineagePulse/R/main_RSA.R")
objectLPcont <- runLineagePulse(matCounts=matCountsAstro[1:100,],
dfAnnotation=dfAnnotationAstro,
vecConfounders=NULL,#c("batch"),
matPiConstPredictors=NULL,
vecNormConstExternal=NULL,
strMuModel="impulse",
strDispModel="constant",
boolClusterInPseudotime=FALSE,
scaKClusters=NULL,
scaWindowRadius=NULL,
boolEstimateNoiseBasedOnH0=TRUE,
boolVecWindowsAsBFGS=FALSE,
boolCoEstDispMean=TRUE,
scaMaxEstimationCycles=20,
scaNProc=6,
boolVerbose=TRUE,
boolSuperVerbose=TRUE )
source("~/gitDevelopment/LineagePulse/R/main_RSA.R")
objectLPcont <- runLineagePulse(matCounts=matCountsAstro[1:100,],
dfAnnotation=dfAnnotationAstro,
vecConfounders=c("batch"),
matPiConstPredictors=NULL,
vecNormConstExternal=NULL,
strMuModel="impulse",
strDispModel="constant",
boolClusterInPseudotime=FALSE,
scaKClusters=NULL,
scaWindowRadius=NULL,
boolEstimateNoiseBasedOnH0=TRUE,
boolVecWindowsAsBFGS=FALSE,
boolCoEstDispMean=TRUE,
scaMaxEstimationCycles=20,
scaNProc=6,
boolVerbose=TRUE,
boolSuperVerbose=TRUE )
